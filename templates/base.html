<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Licensing Roadmap{% endblock %}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Mapbox GL JS CSS -->
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    {% block styles %}{% endblock %}
</head>
<body class="dashboard-layout">
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <div class="top-nav-left">
            <span class="top-nav-brand">ğŸ”§ Licensing Roadmap</span>
            <span class="top-nav-subtitle">Professional License Tracking</span>
        </div>
        <div class="top-nav-right">
            <!-- Brag Bar -->
            <div class="brag-bar">
                <a href="/logout" class="btn btn-sm btn-outline-light me-3" style="font-size: 0.75rem; padding: 0.25rem 0.75rem;">
                    ğŸ”’ Logout
                </a>
                <div class="brag-item">
                    <div class="brag-number">{% block brag_licenses %}{{ holder.total_licenses if holder else 29 }}{% endblock %}</div>
                    <div class="brag-label">Licenses</div>
                </div>
                <div class="brag-divider"></div>
                <div class="brag-item">
                    <div class="brag-number">{% block brag_certs %}{{ holder.total_certificates if holder else 42 }}{% endblock %}</div>
                    <div class="brag-label">Certificates</div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Layout Container -->
    <div class="main-container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-content">
                <!-- Account Selector -->
                <div class="sidebar-section account-selector-section">
                    <h6 class="sidebar-heading">Active Account</h6>
                    {% if session.get('user_type') == 'manager' %}
                        <!-- Manager can switch accounts -->
                        <select id="accountSelector" class="account-selector">
                            <option value="bhambrick" {% if holder and holder.user_id == 'bhambrick' %}selected{% endif %}>ğŸ‘¤ Benjamin Hambrick</option>
                            <option value="jsmith" {% if holder and holder.user_id == 'jsmith' %}selected{% endif %}>ğŸ‘¤ John Smith</option>
                            <option value="director" {% if not holder or holder.user_id == 'director' %}selected{% endif %}>ğŸ‘” Director View</option>
                        </select>
                    {% else %}
                        <!-- License holder sees only their account -->
                        <div class="account-display">
                            <div class="account-name">ğŸ‘¤ {{ session.get('name', 'User') }}</div>
                            <div class="account-role" style="font-size: 0.75rem; color: #6c757d; margin-top: 0.25rem;">License Holder</div>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Stats Section -->
                <div class="sidebar-section">
                    <h6 class="sidebar-heading">License Overview</h6>
                    
                    <div class="sidebar-stat">
                        <div class="sidebar-stat-icon stat-success">âœ“</div>
                        <div class="sidebar-stat-content">
                            <div class="sidebar-stat-value">{% block stat_licensed %}{{ stats.licensed if stats else 0 }}{% endblock %}</div>
                            <div class="sidebar-stat-label">Licensed</div>
                        </div>
                    </div>
                    
                    <div class="sidebar-stat">
                        <div class="sidebar-stat-icon stat-primary">âŸ³</div>
                        <div class="sidebar-stat-content">
                            <div class="sidebar-stat-value">{% block stat_progress %}{{ stats.in_progress if stats else 0 }}{% endblock %}</div>
                            <div class="sidebar-stat-label">In Progress</div>
                        </div>
                    </div>
                    
                    <div class="sidebar-stat">
                        <div class="sidebar-stat-icon stat-warning">âš </div>
                        <div class="sidebar-stat-content">
                            <div class="sidebar-stat-value">{% block stat_due %}{{ stats.due_soon if stats and stats.due_soon else 0 }}{% endblock %}</div>
                            <div class="sidebar-stat-label">Due Soon</div>
                        </div>
                    </div>
                    
                    <div class="sidebar-stat">
                        <div class="sidebar-stat-icon stat-danger">!</div>
                        <div class="sidebar-stat-content">
                            <div class="sidebar-stat-value">{% block stat_overdue %}{{ stats.overdue if stats and stats.overdue else 0 }}{% endblock %}</div>
                            <div class="sidebar-stat-label">Overdue</div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Section -->
                <div class="sidebar-section sidebar-nav">
                    <h6 class="sidebar-heading">Navigation</h6>
                    
                    {% if session.get('user_type') == 'manager' %}
                        <!-- MANAGER/DIRECTOR VIEW -->
                        <div class="nav-group">
                            <small class="nav-group-label">OVERVIEW</small>
                            <a href="/?account={{ holder.user_id if holder else 'director' }}" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">ğŸ </span>
                                <span>Dashboard</span>
                            </a>
                            <a href="/licensing-roadmap?account={{ holder.user_id if holder else 'director' }}" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">ğŸ—ºï¸</span>
                                <span>Map View</span>
                            </a>
                            <a href="/cost-analytics?account={{ holder.user_id if holder else 'director' }}" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">ğŸ’°</span>
                                <span>Cost Analytics</span>
                            </a>
                        </div>
                        
                        <div class="nav-group mt-3">
                            <small class="nav-group-label">TEAM</small>
                            <a href="/team/manage?account={{ holder.user_id if holder else 'director' }}" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">ğŸ‘¥</span>
                                <span>Team Members</span>
                            </a>
                            <a href="/manage-licenses?account={{ holder.user_id if holder else 'director' }}" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">ğŸ“œ</span>
                                <span>All Licenses</span>
                            </a>
                            <a href="/import-csv-page" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">ğŸ“¤</span>
                                <span>Import Data</span>
                            </a>
                        </div>
                        
                        <div class="nav-group mt-3">
                            <small class="nav-group-label">RESOURCES</small>
                            <a href="/admin/state-encyclopedia" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">ğŸ“š</span>
                                <span>State Encyclopedia</span>
                            </a>
                            <a href="/settings?account={{ holder.user_id if holder else 'director' }}" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">âš™ï¸</span>
                                <span>Settings</span>
                            </a>
                        </div>
                        
                    {% else %}
                        <!-- LICENSE HOLDER VIEW -->
                        <div class="nav-group">
                            <small class="nav-group-label">MY LICENSES</small>
                            <a href="/?account={{ session.get('user_id', 'bhambrick') }}" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">ğŸ </span>
                                <span>My Dashboard</span>
                            </a>
                            <a href="/licensing-roadmap?account={{ session.get('user_id', 'bhambrick') }}" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">ğŸ—ºï¸</span>
                                <span>My Map View</span>
                            </a>
                            <a href="/manage-licenses?account={{ session.get('user_id', 'bhambrick') }}" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">ğŸ“œ</span>
                                <span>My Licenses</span>
                            </a>
                            <a href="/bio/{{ session.get('user_id', 'bhambrick') }}" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">ğŸ“</span>
                                <span>My Bio</span>
                            </a>
                        </div>
                        
                        <div class="nav-group mt-3">
                            <small class="nav-group-label">RESOURCES</small>
                            <a href="/states/directory" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">ğŸ“š</span>
                                <span>State Requirements</span>
                            </a>
                            <a href="/settings?account={{ session.get('user_id', 'bhambrick') }}" class="sidebar-nav-item">
                                <span class="sidebar-nav-icon">âš™ï¸</span>
                                <span>My Settings</span>
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="content-area">
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Mapbox GL JS -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>
    
    <!-- TopoJSON -->
    <script src="https://unpkg.com/topojson@3"></script>
    
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- Mapbox Map Script -->
    <script src="{{ url_for('static', filename='js/mapbox-map.js') }}"></script>
    
    <!-- Account Switcher -->
    <script>
        document.getElementById('accountSelector')?.addEventListener('change', function() {
            const account = this.value;
            // Preserve current page, just change account
            const currentPath = window.location.pathname;
            window.location.href = currentPath + '?account=' + account;
        });
    </script>
</body>
</html>

{% extends "base.html" %}

{% block title %}{{ state.state }} - Licensing Requirements{% endblock %}

{% block content %}
<div class="settings-page">
    <div class="container-fluid px-4 py-3">
        
        <!-- Header -->
        <div class="page-header-compact mb-3">
            <div>
                <a href="/licensing-roadmap?account={{ holder.user_id if holder else 'bhambrick' }}" class="btn btn-sm btn-outline-secondary mb-2">‚Üê Back to Map</a>
                <h3>{{ state.state }} ({{ state.state_abbr }}) Licensing Guide</h3>
                <p class="text-muted mb-0">{{ state.governing_body }}</p>
            </div>
        </div>

        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                
                <!-- Quick Stats -->
                <div class="row g-2 mb-3">
                    <div class="col-md-3">
                        <div class="compact-stats-card text-center">
                            <div class="stat-value">{{ state.license_types|length }}</div>
                            <div class="stat-label">License Types</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="compact-stats-card text-center">
                            <div class="stat-value">{{ state.requirements.minimum_age }}</div>
                            <div class="stat-label">Min. Age</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="compact-stats-card text-center">
                            <div class="stat-value">{{ state.renewal.continuing_education_hours }}</div>
                            <div class="stat-label">CE Hours/Year</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="compact-stats-card text-center">
                            <div class="stat-value">${{ state.renewal.renewal_fee }}</div>
                            <div class="stat-label">Renewal Fee</div>
                        </div>
                    </div>
                </div>

                <!-- License Types -->
                <div class="netsuite-table-card mb-3">
                    <div class="p-3 border-bottom">
                        <h6 class="mb-0">üìú Available License Types</h6>
                    </div>
                    <div class="p-3">
                        {% for license in state.license_types %}
                        <div class="license-type-card mb-3">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">{{ license.name }}</h6>
                                    <p class="text-muted small mb-2">{{ license.description }}</p>
                                    <div class="row g-2 small">
                                        <div class="col-md-6">
                                            <strong>Experience:</strong> {{ license.experience_required }}
                                        </div>
                                        <div class="col-md-6">
                                            <strong>Exam:</strong> {{ 'Required (' + license.exam_type + ')' if license.exam_required else 'Not Required' }}
                                        </div>
                                        <div class="col-md-4">
                                            <strong>Application:</strong> ${{ "%.2f"|format(license.application_fee) }}
                                        </div>
                                        <div class="col-md-4">
                                            <strong>Exam:</strong> ${{ "%.2f"|format(license.exam_fee) }}
                                        </div>
                                        <div class="col-md-4">
                                            <strong>License:</strong> ${{ "%.2f"|format(license.license_fee) }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Requirements -->
                <div class="netsuite-table-card mb-3">
                    <div class="p-3 border-bottom">
                        <h6 class="mb-0">‚úÖ Basic Requirements</h6>
                    </div>
                    <div class="p-3">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <strong>Minimum Age:</strong> {{ state.requirements.minimum_age }} years old
                            </div>
                            <div class="col-md-6">
                                <strong>Residency Required:</strong> {{ 'Yes' if state.requirements.residency_required else 'No' }}
                            </div>
                            <div class="col-md-6">
                                <strong>Background Check:</strong> {{ 'Yes' if state.requirements.background_check else 'No' }}
                            </div>
                            <div class="col-md-6">
                                <strong>Education:</strong> {{ state.requirements.education }}
                            </div>
                            {% if state.requirements.experience_breakdown %}
                            <div class="col-12">
                                <strong>Experience Breakdown:</strong>
                                <ul class="mb-0 mt-1">
                                    {% for key, value in state.requirements.experience_breakdown.items() %}
                                    <li>{{ key.replace('_', ' ').title() }}: {{ value }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Examination -->
                <div class="netsuite-table-card mb-3">
                    <div class="p-3 border-bottom">
                        <h6 class="mb-0">üìù Examination Details</h6>
                    </div>
                    <div class="p-3">
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <strong>Test Provider:</strong> {{ state.examination.provider }}
                            </div>
                            <div class="col-md-6">
                                <strong>Format:</strong> {{ state.examination.test_format }}
                            </div>
                            <div class="col-md-6">
                                <strong>Reference Materials:</strong> {{ state.examination.reference_materials }}
                            </div>
                            <div class="col-md-6">
                                <strong>Scheduling:</strong> {{ state.examination.scheduling }}
                            </div>
                            <div class="col-md-6">
                                <strong>Results:</strong> {{ state.examination.results }}
                            </div>
                            <div class="col-md-6">
                                <strong>Retake Policy:</strong> {{ state.examination.retake_policy }}
                            </div>
                        </div>

                        <h6 class="mb-2">Required Books</h6>
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>Book</th>
                                    <th>Cost</th>
                                    <th>Vendor</th>
                                    <th>Required For</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for book in state.examination.required_books %}
                                <tr>
                                    <td>{{ book.name }}</td>
                                    <td>${{ "%.2f"|format(book.cost) }}</td>
                                    <td>{{ book.vendor }}</td>
                                    <td>{{ book.required_for|join(', ') }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>

                        <h6 class="mb-2 mt-3">Test Details by License Type</h6>
                        {% for license_key, details in state.examination.test_details.items() %}
                        <div class="mb-2">
                            <strong>{{ license_key.title() }}:</strong>
                            {{ details.duration_hours }} hours, {{ details.questions }} questions, 
                            {{ details.passing_score }} passing score
                            <div class="small text-muted">Sections: {{ details.sections|join(' | ') }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Application Process -->
                <div class="netsuite-table-card mb-3">
                    <div class="p-3 border-bottom">
                        <h6 class="mb-0">üìã Application Process (Step-by-Step)</h6>
                    </div>
                    <div class="p-3">
                        {% for step in state.application_process %}
                        <div class="application-step mb-3">
                            <div class="d-flex align-items-start">
                                <div class="step-number me-3">{{ step.step }}</div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">{{ step.title }}</h6>
                                    <p class="mb-1">{{ step.description }}</p>
                                    {% if step.forms_required %}
                                    <div class="small text-muted">Forms: {{ step.forms_required|join(', ') }}</div>
                                    {% endif %}
                                    {% if step.fees %}
                                    <div class="small text-muted">Fee: ${{ "%.2f"|format(step.fees) }}</div>
                                    {% endif %}
                                    <div class="small"><strong>Timeline:</strong> {{ step.timeline }}</div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Insurance & Bonding -->
                <div class="netsuite-table-card mb-3">
                    <div class="p-3 border-bottom">
                        <h6 class="mb-0">üõ°Ô∏è Insurance & Bonding Requirements</h6>
                    </div>
                    <div class="p-3">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <strong>Liability Insurance Required:</strong> {{ 'Yes' if state.insurance_bonding.liability_insurance_required else 'No' }}
                            </div>
                            <div class="col-md-6">
                                <strong>Bond Required:</strong> {{ 'Yes' if state.insurance_bonding.bond_required else 'No' }}
                            </div>
                            <div class="col-12">
                                <strong>Notes:</strong> {{ state.insurance_bonding.notes }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Renewal -->
                <div class="netsuite-table-card mb-3">
                    <div class="p-3 border-bottom">
                        <h6 class="mb-0">üîÑ Renewal Requirements</h6>
                    </div>
                    <div class="p-3">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <strong>Renewal Period:</strong> {{ state.renewal.period }}
                            </div>
                            <div class="col-md-6">
                                <strong>Renewal Fee:</strong> ${{ "%.2f"|format(state.renewal.renewal_fee) }}
                            </div>
                            <div class="col-md-6">
                                <strong>CE Hours Required:</strong> {{ state.renewal.continuing_education_hours }}
                            </div>
                            <div class="col-md-6">
                                <strong>CE Topics:</strong> {{ state.renewal.ce_topics|join(', ') }}
                            </div>
                            <div class="col-12">
                                <strong>CE Providers:</strong> {{ state.renewal.ce_providers|join(', ') }}
                            </div>
                            <div class="col-md-6">
                                <strong>Late Renewal:</strong> {{ state.renewal.late_renewal }}
                            </div>
                            <div class="col-md-6">
                                <strong>Inactive Status:</strong> {{ state.renewal.inactive_status }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reciprocity -->
                <div class="netsuite-table-card mb-3">
                    <div class="p-3 border-bottom">
                        <h6 class="mb-0">ü§ù Reciprocity & Endorsement</h6>
                    </div>
                    <div class="p-3">
                        <div class="mb-2">
                            <strong>Accepts Licenses From:</strong> {{ state.reciprocity.accepts_from|join(', ') }}
                        </div>
                        <div class="mb-2">
                            <strong>Endorsement Process:</strong> {{ state.reciprocity.endorsement_process }}
                        </div>
                        <div class="alert alert-info mb-0">
                            {{ state.reciprocity.notes }}
                        </div>
                    </div>
                </div>

            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                
                <!-- Contact Info -->
                <div class="compact-stats-card mb-3">
                    <h6 class="mb-3">üìû Board Contact</h6>
                    <div class="small">
                        <p><strong>{{ state.governing_body }}</strong></p>
                        <p class="mb-1">{{ state.board_address }}</p>
                        <p class="mb-1">Phone: {{ state.board_phone }}</p>
                        <p class="mb-1"><a href="{{ state.board_website }}" target="_blank">{{ state.board_website }}</a></p>
                    </div>
                </div>

                <!-- Pro Tips -->
                <div class="compact-stats-card mb-3 bg-success bg-opacity-10 border-success">
                    <h6 class="mb-3">üí° Pro Tips</h6>
                    <ul class="small mb-0">
                        {% for tip in state.pro_tips %}
                        <li class="mb-2">{{ tip }}</li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Common Pitfalls -->
                <div class="compact-stats-card mb-3 bg-warning bg-opacity-10 border-warning">
                    <h6 class="mb-3">‚ö†Ô∏è Common Pitfalls</h6>
                    <ul class="small mb-0">
                        {% for pitfall in state.common_pitfalls %}
                        <li class="mb-2">{{ pitfall }}</li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Resources -->
                <div class="compact-stats-card">
                    <h6 class="mb-3">üìö Resources</h6>
                    
                    <div class="mb-3">
                        <strong class="small">Official Links</strong>
                        <ul class="small mb-0 mt-1">
                            {% for link in state.resources.official_links %}
                            <li><a href="{{ link.url }}" target="_blank">{{ link.name }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>

                    <div class="mb-3">
                        <strong class="small">Study Materials</strong>
                        <ul class="small mb-0 mt-1">
                            {% for material in state.resources.study_materials %}
                            <li>
                                <a href="{{ material.url }}" target="_blank">{{ material.name }}</a>
                                {% if material.cost > 0 %} - ${{ "%.2f"|format(material.cost) }}{% endif %}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>

                    {% if state.resources.prep_courses %}
                    <div>
                        <strong class="small">Prep Courses</strong>
                        <ul class="small mb-0 mt-1">
                            {% for course in state.resources.prep_courses %}
                            <li>
                                {{ course.name }} - {{ course.provider }}
                                <div class="text-muted">{{ course.cost }} | {{ course.notes }}</div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>

            </div>
        </div>
    </div>
</div>

<style>
.license-type-card {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 1rem;
}

.application-step {
    border-left: 3px solid var(--accent-copper);
    padding-left: 1rem;
}

.step-number {
    background: var(--accent-copper);
    color: white;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    flex-shrink: 0;
}
</style>
{% endblock %}
